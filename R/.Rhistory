FROM contratos c
INNER JOIN lm
USING (cd_UGestora, nu_Licitacao, tp_Licitacao)
')
contratos <- tbl(sagres, query) %>%
compute(name = 'cm') %>%
collect()
query <- sql('
SELECT a.*
FROM aditivos a
INNER JOIN cm
USING (cd_UGestora, nu_Contrato)
')
aditivos <- tbl(sagres, query) %>%
collect()
query <- sql('
SELECT e.*
FROM empenhos e
USE INDEX (licitacao)
INNER JOIN lm
USING (cd_UGestora, nu_Licitacao, tp_Licitacao)
')
empenhos <- tbl(sagres, query) %>%
compute(name = 'em') %>%
collect()
query <- sql('
SELECT l.*
FROM liquidacao l
INNER JOIN em
USING (cd_UGestora, nu_Empenho, cd_UnidOrcamentaria, dt_Ano)
')
liquidacoes <- tbl(sagres, query) %>%
compute(name = 'lqm') %>%
collect()
query <- sql('
SELECT p.*
FROM pagamentos p
INNER JOIN em
USING (cd_UGestora, nu_Empenho, cd_UnidOrcamentaria, dt_Ano)
')
pagamentos <- tbl(sagres, query) %>%
compute(name = 'pm') %>%
collect()
query <- sql('
SELECT e.*
FROM estorno e
INNER JOIN em
USING (cd_UGestora, nu_Empenho, cd_UnidOrcamentaria, dt_Ano)
')
estornos <- tbl(sagres, query) %>%
collect()
query <- sql('
SELECT el.*
FROM estornoliquidacao el
INNER JOIN lqm
USING (cd_UGestora, nu_Empenho, cd_UnidOrcamentaria, dt_Ano, nu_Liquidacao)
')
estornos.liquidacoes <- tbl(sagres, query) %>%
collect()
query <- sql('
SELECT ep.*
FROM estornopagamento ep
INNER JOIN pm
ON
ep.cd_UGestora = pm.cd_UGestora AND
ep.nu_EmpenhoEstorno = pm.nu_Empenho AND
ep.cd_UnidOrcamentaria = pm.cd_UnidOrcamentaria AND
ep.dt_Ano = pm.dt_Ano AND
ep.nu_ParcelaEstorno = pm.nu_Parcela AND
ep.tp_Lancamento = pm.tp_Lancamento
')
estornos.pagamentos <- tbl(sagres, query) %>%
collect()
sagres = src_mysql('sagres', group='ministerio-publico', password=NULL)
query <- sql('
SELECT *
FROM licitacao
WHERE de_Obs REGEXP "merenda"
AND dt_Ano BETWEEN 2011 AND 2015
')
licitacoes <- tbl(sagres, query) %>%
compute(name = 'lm') %>%
collect()
licitacoes = tbl(sagres, 'licitacao') %>% collect()
View(licitacoes)
View(contratos)
licitacoes = tbl(sagres, 'licitacao') %>% collect(n = Inf)
View(licitacoes)
str(licitacoes)
licitacoes.cg = filter(licitacoes, cd_UGestora %in% c(101050, 201050,  301050, 302050 , 303050 , 601050, 602050,  603050, 604050, 605050))
View(licitacoes.cg)
outraslic = read.csv('../../Downloads/licitacoes-pmcg.csv')
result = outraslic %>% left_join(licitacoes.cg, by = c('num_licitacao' = 'nu_licitacao'))
result = outraslic %>% left_join(licitacoes.cg, by = c('num_licitacao' = 'nu_Licitacao'))
licitacoes.cg = licitacoes.cg %>%
mutate(nu_Licitacao = as.character(nu_Licitacao))
result = outraslic %>% left_join(licitacoes.cg, by = c('num_licitacao' = 'nu_Licitacao'))
mutate(nu_Licitacao = as.integer(nu_Licitacao))
licitacoes.cg = licitacoes.cg %>%
mutate(nu_Licitacao = as.integer(nu_Licitacao))
result = outraslic %>% left_join(licitacoes.cg, by = c('num_licitacao' = 'nu_Licitacao'))
View(result)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 1000)
str(dados_nota)
View(dados_nota)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 1000)
str(dados_nota)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100,
colClasses = c(
"Chave_de_acesso" = "character",
"Inscricao_estadual_emit" = "character",
))
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100,
colClasses = c(
"Chave_de_acesso" = "character",
"Inscricao_estadual_emit" = "character"
))
str(dados_nota)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100,
na.strings = c("")
)
str(dados_nota)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100,
na.strings = c(""), colClasses = c(
"Chave_de_acesso" = "character",
"Inscricao_estadual_emit" = "character",
"Valor_total_prod" = "character"
)
)
str(dados_nota)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100,
na.strings = c(""), colClasses = c(
"Chave_de_acesso" = "character",
"Inscricao_estadual_emit" = "character",
"Valor_total_prod" = "numeric"
)
)
names(dados_nota)
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(c("Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
gsub('.', '', .)
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota)
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota)
dados_nota <- lapply(dados_nota, function(x) as.numeric(gsub("\\.", "", x)))
warnings()
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota)
dados_nota[] <- lapply(dados_nota, function(x) as.numeric(gsub("\\.", "", x)))
View(dados_nota)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(c("Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
gsub('\\.', '', .)
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(c("Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
gsub('\\.', '', .)
)
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate(Valor_total_da_nota, gsub('\\.', '', Valor_total_da_nota))
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate(Valor_total_da_nota, gsub('\.', '', Valor_total_da_nota))
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate(Valor_total_da_nota, gsub('.', '', Valor_total_da_nota))
?gsub
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate(Valor_total_da_nota = gsub('\\.', '', Valor_total_da_nota))
:mutate_at
?mutate_at
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
gsub('\\.', '')
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
gsub('\\.', '')
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(gsub('\\.', '', .))
)
str(dados_nota)
str(dados_nota)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(as.numeric(gsub('\\.', '', .)))
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(as.numeric(gsub('\\.', '', .)))
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(gsub('\\.', '', .))
) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(as.numeric(.))
)
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(gsub('\\.', '', .))
)
str(dados_nota)
?as.numeric
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(gsub(',', '\\.', gsub('\\.', '', .)))
) %>%
mutate_at(
c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
),
funs(as.numeric(.))
)
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE, nrows = 100
)
variaveis_numericas <- c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(variaveis_numericas, funs(gsub('\\.', '', .))) %>%
mutate_at(variaveis_numericas, funs(gsub(',', '\\.', .))) %>%
mutate_at(variaveis_numericas, funs(as.numeric(.)))
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
dados_nota <- read.table('analises/merenda/dados/notas_fiscais/dados_nf.txt',
sep = '|', header = TRUE, dec = ",",
quote = "", fill = TRUE, encoding = 'latin1',
strip.white=T, stringsAsFactors = FALSE)
variaveis_numericas <- c(
"Valor_total_da_nota", "Valor_fatura", "Base_de_Calculo_do_ICMS", "Valor_do_ICMS",
"Base_de_calculo_do_ICMS_substituicao", "Valor_do_ICMS_substituicao", "Valor_total_dos_produtos",
"Valor_do_frete", "Valor_do_seguro", "Valor_desconto", "Valor_outras_despesas_acessorias", "Valor_do_IPI",
"Valor_total_ICMS_UF_dest", "Valor_total_ICMS_UF_remet", "Valor_BC_ICMS_UF_dest", "Aliquota_interna_UF_dest",
"Aliquota_interestadual_UF_env", "Valor_ICMS_FCP_UF_dest", "Valor_ICMS_partilha_UF_dest",
"Valor_ICMS_partilha_UF_remet", "Quant_prod", "Valor_unit_prod", "Valor_total_prod", "Valor_desconto_item" ,
"BC_ICMS_prod", "Valor_ICMS_prod", "Aliq_ICMS_prod", "BC_ICMS_ST_prod", "Valor_ICMS_ST_prod",
"Aliq_ICMS_ST_prod", "Valor_IPI_prod", "Aliq_IPI_prod", "Valor_PMC_prod"
)
dados_nota <- dados_nota %>%
rename(Valor_total_da_nota = Valor_total_da._nota) %>%
mutate_at(variaveis_numericas, funs(gsub('\\.', '', .))) %>%
mutate_at(variaveis_numericas, funs(gsub(',', '\\.', .))) %>%
mutate_at(variaveis_numericas, funs(as.numeric(.)))
str(dados_nota)
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
?write.csv
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R')
source('~/workspace/licitacoes/analises/merenda/variacao-preco/variacao-preco.R', echo=TRUE)
getwd()
source('~/workspace/filtrosagres/rsagrespb/R/load_licitantes_merenda.R', echo=TRUE)
?require
setwd("~/workspace/filtrosagres/rsagrespb/R")
library(methods)
library(dplyr)
library(stringr)
library(tidyr)
load_licitacoes_merenda <- function(){
sagres <- src_mysql('sagres', group='ministerio-publico', password=NULL)
query <- sql('
select *
from licitacao
inner join classificacao_licitacao
using (cd_UGestora, nu_Licitacao, tp_Licitacao)
where pr_EmpenhosMerenda >= 0.8
')
licitacoes_merenda <- tbl(sagres, query)
return(licitacoes_merenda)
}
a = load_licitacoes_merenda()
